import React, { useEffect, useState } from 'react';
import { userService, bookingService, paymentService } from '../services/api';
import { toast } from 'react-toastify';
import { FaUsers, FaMoneyBillWave, FaCalendar, FaChartBar, FaSearch } from 'react-icons/fa';

const AdminDashboard = () => {
  const [stats, setStats] = useState({
    totalUsers: 0,
    totalCleaners: 0,
    totalBookings: 0,
    totalRevenue: 0,
    totalPayouts: 0,
    platformFee: 0
  });

  const [users, setUsers] = useState([]);
  const [bookings, setBookings] = useState([]);
  const [payments, setPayments] = useState([]);
  const [activeTab, setActiveTab] = useState('overview');
  const [searchTerm, setSearchTerm] = useState('');
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    loadAdminData();
  }, []);

  const loadAdminData = async () => {
    setIsLoading(true);
    try {
      // Buscar dados de usu√°rios, agendamentos e pagamentos
      // (API ainda n√£o implementada no backend)
      
      // Mock data para demonstra√ß√£o
      setStats({
        totalUsers: 156,
        totalCleaners: 42,
        totalBookings: 1203,
        totalRevenue: 45200.50,
        totalPayouts: 31500.00,
        platformFee: 13700.50
      });

      setUsers([
        { id: 1, name: 'Maria Silva', type: 'cleaner', email: 'maria@email.com', status: 'active', joinDate: '2025-10-15' },
        { id: 2, name: 'Jo√£o Santos', type: 'client', email: 'joao@email.com', status: 'active', joinDate: '2025-11-20' },
        { id: 3, name: 'Ana Costa', type: 'cleaner', email: 'ana@email.com', status: 'verified', joinDate: '2025-09-10' }
      ]);

      setBookings([
        { id: 1, client: 'Jo√£o Santos', cleaner: 'Maria Silva', date: '2026-02-01', status: 'completed', amount: 150.00 },
        { id: 2, client: 'Pedro Costa', cleaner: 'Ana Costa', date: '2026-02-02', status: 'pending', amount: 120.00 }
      ]);

      setPayments([
        { id: 1, cleaner: 'Maria Silva', amount: 1500.00, status: 'completed', date: '2026-01-25' },
        { id: 2, cleaner: 'Ana Costa', amount: 980.00, status: 'pending', date: '2026-01-26' }
      ]);
    } catch (error) {
      toast.error('Erro ao carregar dados do admin');
    } finally {
      setIsLoading(false);
    }
  };

  const filteredUsers = users.filter(u => 
    u.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    u.email.toLowerCase().includes(searchTerm.toLowerCase())\n  );

  if (isLoading) {
    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p className=\"text-lg text-gray-600\">Carregando painel admin...</p>\n      </div>\n    );\n  }

  return (\n    <div className=\"min-h-screen bg-gray-900 text-white\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-b border-gray-700 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <h1 className=\"text-3xl font-bold mb-2\">üõ°Ô∏è Painel Administrativo</h1>\n          <p className=\"text-gray-400\">Gerenciar usu√°rios, pagamentos e agendamentos</p>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto p-6\">\n        {/* KPIs */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8\">\n          {/* Total Users */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Total de Usu√°rios</p>\n                <p className=\"text-3xl font-bold mt-2\">{stats.totalUsers}</p>\n              </div>\n              <FaUsers className=\"text-4xl text-blue-500 opacity-30\" />\n            </div>\n          </div>\n\n          {/* Total Cleaners */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Faxineiras</p>\n                <p className=\"text-3xl font-bold mt-2\">{stats.totalCleaners}</p>\n              </div>\n              <FaUsers className=\"text-4xl text-green-500 opacity-30\" />\n            </div>\n          </div>\n\n          {/* Total Bookings */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Agendamentos</p>\n                <p className=\"text-3xl font-bold mt-2\">{stats.totalBookings}</p>\n              </div>\n              <FaCalendar className=\"text-4xl text-yellow-500 opacity-30\" />\n            </div>\n          </div>\n\n          {/* Total Revenue */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Receita Total</p>\n                <p className=\"text-2xl font-bold mt-2\">R$ {stats.totalRevenue.toFixed(2)}</p>\n              </div>\n              <FaMoneyBillWave className=\"text-4xl text-green-500 opacity-30\" />\n            </div>\n          </div>\n\n          {/* Platform Fee */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Taxa Plataforma</p>\n                <p className=\"text-2xl font-bold mt-2\">R$ {stats.platformFee.toFixed(2)}</p>\n              </div>\n              <FaChartBar className=\"text-4xl text-purple-500 opacity-30\" />\n            </div>\n          </div>\n\n          {/* Total Payouts */}\n          <div className=\"bg-gray-800 rounded-lg p-4 border border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-gray-400 text-sm\">Pagamentos</p>\n                <p className=\"text-2xl font-bold mt-2\">R$ {stats.totalPayouts.toFixed(2)}</p>\n              </div>\n              <FaMoneyBillWave className=\"text-4xl text-orange-500 opacity-30\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex gap-4 mb-6 border-b border-gray-700\">\n          <button\n            onClick={() => setActiveTab('users')}\n            className={`px-4 py-2 font-semibold transition ${\n              activeTab === 'users'\n                ? 'text-white border-b-2 border-blue-500'\n                : 'text-gray-400 hover:text-gray-200'\n            }`}\n          >\n            üë• Usu√°rios ({stats.totalUsers})\n          </button>\n          <button\n            onClick={() => setActiveTab('bookings')}\n            className={`px-4 py-2 font-semibold transition ${\n              activeTab === 'bookings'\n                ? 'text-white border-b-2 border-blue-500'\n                : 'text-gray-400 hover:text-gray-200'\n            }`}\n          >\n            üìÖ Agendamentos ({stats.totalBookings})\n          </button>\n          <button\n            onClick={() => setActiveTab('payments')}\n            className={`px-4 py-2 font-semibold transition ${\n              activeTab === 'payments'\n                ? 'text-white border-b-2 border-blue-500'\n                : 'text-gray-400 hover:text-gray-200'\n            }`}\n          >\n            üí∞ Pagamentos\n          </button>\n        </div>\n\n        {/* TAB: USERS */}\n        {activeTab === 'users' && (\n          <div className=\"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden\">\n            {/* Search */}\n            <div className=\"p-4 border-b border-gray-700\">\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Buscar por nome ou email...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500\"\n                />\n                <button className=\"px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition flex items-center gap-2\">\n                  <FaSearch /> Buscar\n                </button>\n              </div>\n            </div>\n\n            {/* Table */}\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-gray-900 border-b border-gray-700\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left\">Nome</th>\n                    <th className=\"px-6 py-3 text-left\">Tipo</th>\n                    <th className=\"px-6 py-3 text-left\">Email</th>\n                    <th className=\"px-6 py-3 text-left\">Status</th>\n                    <th className=\"px-6 py-3 text-left\">Entrou em</th>\n                    <th className=\"px-6 py-3 text-left\">A√ß√µes</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredUsers.map((user) => (\n                    <tr key={user.id} className=\"border-b border-gray-700 hover:bg-gray-700 transition\">\n                      <td className=\"px-6 py-3 font-semibold\">{user.name}</td>\n                      <td className=\"px-6 py-3\">\n                        <span className={`px-2 py-1 rounded text-xs font-semibold ${\n                          user.type === 'cleaner' ? 'bg-green-900 text-green-200' : 'bg-blue-900 text-blue-200'\n                        }`}>\n                          {user.type === 'cleaner' ? 'üë©‚Äçüîß Faxineira' : 'üë§ Cliente'}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-3 text-gray-400\">{user.email}</td>\n                      <td className=\"px-6 py-3\">\n                        <span className={`px-2 py-1 rounded text-xs font-semibold ${\n                          user.status === 'active' ? 'bg-green-900 text-green-200' :\n                          user.status === 'verified' ? 'bg-blue-900 text-blue-200' :\n                          'bg-yellow-900 text-yellow-200'\n                        }`}>\n                          {user.status === 'active' ? '‚úÖ Ativo' : user.status === 'verified' ? '‚úîÔ∏è Verificado' : '‚è≥ Pendente'}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-3 text-gray-400\">{new Date(user.joinDate).toLocaleDateString('pt-BR')}</td>\n                      <td className=\"px-6 py-3\">\n                        <button className=\"text-blue-400 hover:text-blue-300 text-sm font-semibold\">Ver Perfil</button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* TAB: BOOKINGS */}\n        {activeTab === 'bookings' && (\n          <div className=\"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-gray-900 border-b border-gray-700\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left\">Cliente</th>\n                    <th className=\"px-6 py-3 text-left\">Faxineira</th>\n                    <th className=\"px-6 py-3 text-left\">Data</th>\n                    <th className=\"px-6 py-3 text-left\">Valor</th>\n                    <th className=\"px-6 py-3 text-left\">Status</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {bookings.map((booking) => (\n                    <tr key={booking.id} className=\"border-b border-gray-700 hover:bg-gray-700 transition\">\n                      <td className=\"px-6 py-3\">{booking.client}</td>\n                      <td className=\"px-6 py-3\">{booking.cleaner}</td>\n                      <td className=\"px-6 py-3 text-gray-400\">{new Date(booking.date).toLocaleDateString('pt-BR')}</td>\n                      <td className=\"px-6 py-3 font-semibold\">R$ {booking.amount.toFixed(2)}</td>\n                      <td className=\"px-6 py-3\">\n                        <span className={`px-2 py-1 rounded text-xs font-semibold ${\n                          booking.status === 'completed' ? 'bg-green-900 text-green-200' : 'bg-yellow-900 text-yellow-200'\n                        }`}>\n                          {booking.status === 'completed' ? '‚úÖ Conclu√≠do' : '‚è≥ Pendente'}\n                        </span>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* TAB: PAYMENTS */}\n        {activeTab === 'payments' && (\n          <div className=\"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead className=\"bg-gray-900 border-b border-gray-700\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left\">Faxineira</th>\n                    <th className=\"px-6 py-3 text-left\">Valor</th>\n                    <th className=\"px-6 py-3 text-left\">Data</th>\n                    <th className=\"px-6 py-3 text-left\">Status</th>\n                    <th className=\"px-6 py-3 text-left\">A√ß√µes</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {payments.map((payment) => (\n                    <tr key={payment.id} className=\"border-b border-gray-700 hover:bg-gray-700 transition\">\n                      <td className=\"px-6 py-3\">{payment.cleaner}</td>\n                      <td className=\"px-6 py-3 font-semibold\">R$ {payment.amount.toFixed(2)}</td>\n                      <td className=\"px-6 py-3 text-gray-400\">{new Date(payment.date).toLocaleDateString('pt-BR')}</td>\n                      <td className=\"px-6 py-3\">\n                        <span className={`px-2 py-1 rounded text-xs font-semibold ${\n                          payment.status === 'completed' ? 'bg-green-900 text-green-200' : 'bg-yellow-900 text-yellow-200'\n                        }`}>\n                          {payment.status === 'completed' ? '‚úÖ Pagado' : '‚è≥ Pendente'}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-3\">\n                        {payment.status === 'pending' && (\n                          <button className=\"text-green-400 hover:text-green-300 text-sm font-semibold\">Confirmar</button>\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdminDashboard;
